# HTTP Server
* * *

## Overview

The server inside the base adapter image was generated by using:
- [OpenAPI-Spec](https://github.com/swagger-api/swagger-core/wiki) to define the API.
- [swagger-codegen](https://github.com/swagger-api/swagger-codegen) to generate serrver stubs using the file defined with OpenAPI.
- [Connexion framework](https://github.com/zalando/connexion) to map each of the endpoint specified in the OpenAPI file to map to our Python functions.

## Requirements
Python 3.9+

## Regenerate the server
To regenerate the server, from the repository root directory, update the swagger API JSON file (s)
in `vmware_aria_operations_integration_sdk/api` and run the following command from the `images` directory:

```shell
python3 update-base-python-adapter-server.py
```

This script will combine both of the JSON files inside the `vmware_aria_operations_integration_sdk/api` and then generate a JSON file at `images/base-python-adapter/combined.json`. The combined
JSON file will then be read by swagger to regenerate some of the code inside the `base-python-adapter` directory.

???+ note

  To prevent swagger from overwriting the X file, we rename it to Y. After regenerating the server, Y will have to be specified
  as the Z inside the  TODO file. Then the generated x can be deleted.

## Usage
To run the server, please execute the following from the root directory:

```
pip3 install -r requirements.txt
python3 -m swagger_server
```

and open your browser to here:

```
http://localhost:8080/ui/
```

Your Swagger definition lives here:

```
http://localhost:8080/swagger.json
```

To launch the integration tests, use tox:
```
sudo pip install tox
tox
```

## Running with Docker


```bash
# building the image
docker build -t swagger_server .

# starting up a container
docker run -p 8080:8080 swagger_server
```

## Licensing

As required by OSM's [container build specifications](https://onevmw.sharepoint.com/:w:/s/container-build-specification/EVljkfvbAllMvOQEdp1t2h8B2oTWMx2ZyPWWplKEESKaBw?e=U1njsq), this container uses a version of python that is based on Debian as its base OS.

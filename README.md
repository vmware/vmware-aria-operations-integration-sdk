vROps Integration SDK
=====================

Welcome to the vRealize Operations Integration SDK. 

Where should I start?
* If you want to get started creating your first Management Pack, or don't know where to start, read the 'Get Started' tutorial below.
* If you'd like an introduction to vROps, Management Packs, and this SDK, [read the introduction](doc/introduction.md).
* All documentation is available from the [contents](doc/contents.md) page.

## Get Started

This guide will walk through setting up the SDK and using the SDK
to create, test, and install a simple Management Pack (integration) onto vROps.

Contents
* [Requirements](#requirements)
* [Installation](#installation)
* [Creating a Management Pack](#creating-a-management-pack)
* [Testing a Management Pack](#testing-a-management-pack)
* [Building and Installing a Management Pack](#building-and-installing-a-management-pack)

### Requirements

#### Operating System:
The vROps Integration SDK has been tested in the following OSes:
* Windows 10
* Windows 11
* macOS Monterey
* Debian Linux
* Fedora Linux
    
Other operating systems may be compatible.

#### vRealize Operations
The Management Packs generated by the vROps Integration SDK will only run on vROps versions that supports dockerized Management Packs. Currently, this is limited to on-premise vROps, version 8.7.2 or later.
In addition, at least one Cloud Proxy (also version 8.7.2 or later) must be set up in vROps, as dockerized Management Packs must be run on a Cloud Proxy collector.

> Note: This version of vROps is currently in a pre-release state. Please contact the [vrops-integrations-sdk](https://vmware.slack.com/archives/C03KB8KF2VD) Slack channel if you require assistance obtaining appropriate vROps installation media.

#### Dependencies
* Docker 20.10.0 or later. Updating to the latest stable version is recommended. For instructions on installing Docker,
  go to [Docker's installation documentation](https://docs.docker.com/engine/install/), choose the OS you need and
  follow the instructions provided.
* Python3 3.9.0 or later. Earlier versions of Python3 may also work, but updating to the latest stable version is
  recommended. Python 3.6 and earlier (including Python2) are not supported. For instructions on installing Python, go
  to [Python's installation documentation](https://wiki.python.org/moin/BeginnersGuide/Download), choose the OS you need
  and follow the instructions provided.
* Pip. If Python3 is installed, pip is most likely also installed. For instructions on installing Pip, go
  to [Pip's installation documentation](https://pip.pypa.io/en/stable/installation/), and follow the instructions
  provided.
* Git 2.35.0 or later. Updating to the latest stable version is recommended. 
  For instructions in installing git, go to [Git's installation documentation](https://git-scm.com/downloads),
  choose the OS you need and follow the instructions provided.

[//]: # (TODO: Add this section back in once we support them)
[//]: # (#### Optional Prerequisites)
[//]: # (* Java. Java is only required for building Java Management Packs. We recommend the latest version of the [Azul Zulu SDK]&#40;https://www.azul.com/downloads/?package=jdk#download-openjdk&#41;.)
[//]: # (* Powershell. Powershell is only required for building Powershell Management Packs. See [Microsoft's installation instructions for PowerShell]&#40;https://docs.microsoft.com/en-us/powershell/scripting/install/installing-powershell?view=powershell-7.2&#41;.)
[//]: # (> Note: Creating Java and Powershell Management Packs is disabled for the Beta)

### Installation

To install the SDK, download the SDK Git repository and run the installation script.

The installation script performs several steps:
* Verifies the dependencies (currently macOS and Linux only)
* Creates a config file (`~/.vrops-sdk/config.json` for macOS and Linux, and `%LocalAppData%\VMware\vROps Integration SDK\config.json` for Windows).
* Generates a Python virtual environment
* Installs several tools (`mp-init`, `mp-test`, and `mp-build`) and their requirements into the virtual environment using `Pip`.
  > Note: By default only Pip's warnings and errors are displayed. For more detailed output about what is being installed, pass the `--verbose` flag to the installation script.

For Mac and Linux:
```sh
git clone https://gitlab.eng.vmware.com/cmbu-tvg/vrops-integration-sdk
cd vrops-integration-sdk
./install.sh
```

For Windows:
```cmd
git clone https://gitlab.eng.vmware.com/cmbu-tvg/vrops-integration-sdk
dir vrops-integration-sdk
install.bat
```

To use the SDK, activate the virtual environment:

For Mac and Linux:
```sh
source vrops_mp_sdk_venv/bin/activate
```

For Windows:
```cmd
vrops_mp_sdk_venv\Scripts\activate.bat
```
To exit the virtual environment, run `deactivate` in the virtual environment.

### Creating a Management Pack
To create a new project, run `mp-init` in the virtual environment. This tool asks a series of questions that guides
the creation of a new management pack project. 
> Note: If you see the prompt "Enter path to the 'vrops-integration-sdk' repository:", refer to
> the [mp-init troubleshooting section](doc/mp-init.md#path-to-vrops-integration-sdk)


1. `Enter a path for the project (where code for collection, metadata, and content reside). Path:`

    The path can be an absolute path, or a path relative to the directory `mp-init` was run from. The path should end in an empty
    or non-existing directory. If the directory does not exist, it will be created. This directory will contain a new Management
    Pack project.

2. `Management Pack display name`

    The Management Pack display name will show up in vROps (**Data Sources &rarr; Integrations &rarr;
    Repository**), or when adding an account.

    ![Integration Card for the 'TestAdapter' Management Pack](doc/test-adapter-integration-card.png)

    *This Management Pack's display name is 'TestAdapter', and uses the default icon*

3. `Management Pack adapter key`

    This field is used internally to identify the Management Pack and Adapter Kind. By default, it is set to the 
    Management Pack display name with special characters and whitespace stripped from it.

4. `Management Pack description`

    This field should describe what the Management Pack will do or monitor.

5. `Management Pack vendor`

   The vendor field shows up in the UI under 'About' on the Integration Card.

   ![About popup for the 'TestAdapter' Management Pack](doc/test-adapter-about.png)

   *This Management Pack's vendor is 'VMware'*

6. `Enter a path to a EULA text file, or leave blank for no EULA`

   vROps requires a EULA file to be present in a Management Pack. If one isn't provided, a stub EULA file (`eula.txt` in
   the root project directory) will be added to the project which reads:
    ```
    There is no EULA associated with this Management Pack.
    ```

7. `Enter a path to the Management Pack icon file, or leave blank for no icon`

   The icon is used in the vROps UI if present. If it is not present, a default icon will be used. The icon file must be
   png format and 256x256 px. An icon file can be added later by copying the icon to the root project directory and
   setting the value of the `"pak_icon"` key to the icon's file name in the `manifest.txt` file.

8. `Select a language for the adapter. Supported languages are [...]`

   Supported languages are listed. Once selected, the project will be generated, including a template adapter in the
   selected language. The template adapter collects several objects and metrics from the docker container that the
   adapter is running in, and can be used as a starting point for creating a new adapter.

For complete documentation of the `mp-init` tool see the [MP Initialization Tool Documentation](doc/mp-init.md).

### Testing a Management Pack
To test a project, run `mp-test`  in the virtual environment.

If `mp-test` is run from anywhere outside of a root project directory, the tool will prompt to choose a project, and will
test the selected project. If the tool is run from a project directory, the tool will automatically test that project.

`mp-test` will ask for a _connection_. No connections should exist, so choose **New Connection**. The test tool then
reads the `conf/describe.xml` file to find the connection parameters and credentials required for a connection, and
prompts for each. This is similar to creating a new _Adapter Instance_ in the vROps UI. Connections are automatically
saved per project, and can be reused when re-running the `mp-test` tool.

> Note: In the template project, the only connection parameter is `ID`, and because it connects to the container it is running on, this parameter is not necessary; it is only there as an example, and can be set to any value. The template also implements an example Test Connection. If a Test Connection is run (see below), with the `ID` set to the text `bad`, then the Test Connection will fail.

The test tool also asks for the method to test. There are four options:

* Test Connection - This call tests the connection and returns either an error message if the connection failed, or an
  empty json object if the connection succeeded.
* Collect - This call test the collection, and returns objects, metrics, properties, events, and relationships.
* Endpoint URLs - This returns a list (possibly empty) of URLs that have distinct SSL certificates that vROps can ask
  the end user to import into the vROps TrustStore.
* Version - This returns
  the [vROps Collector API](vrealize_operations_integration_sdk/api/vrops-collector-fwk2-openapi.json) version the
  adapter implements. The implementation of this method is not generally handled by the developer.

For more information on these endpoints, see
the [Swagger API documentation](vrealize_operations_integration_sdk/api/vrops-collector-fwk2-openapi.json). Each
response is validated against the API.

For complete documentation of the `mp-test` tool see the [MP Test Tool Documentation](doc/mp-test.md).

### Building and Installing a Management Pack
To build a project, run `mp-build`  in the virtual environment.

If `mp-build` is run from anywhere outside of a root project directory, the tool will prompt to choose a project, and will
build the selected project. If the tool is run from a project directory, the tool will automatically build that
project.

Once the project is selected (if necessary), the tool will build the management pack and emit a `pak` file which can be 
installed on vROps. The `pak` file will be located in the project directory.

To install the `pak` file, in vROps navigate to **Data Sources &rarr; Integrations &rarr;
Repository** and click `ADD`. Select and upload the generated `pak` file, accept the README, and install the management pack.

To configure the management pack, vROps navigate to **Data Sources &rarr; Integrations &rarr;
Accounts** and click `ADD ACCOUNT`. Select the newly-installed management pack and configure the required fields. For 
`Collector/Group`, make sure that a cloud proxy collector is selected. Click `VALIDATE CONNECTION` to test the connection. 
It should return successfully, then click `ADD`.

By default, a collection will run every 5 minutes. The first collection should happen immediately, however newly-created
objects cannot have metrics, properties, and events added to them. After the second collection, approximately five
minutes later, the objects' metrics, properties, and events should appear. These can be checked by navigating to **
Environment &rarr; Object Browser &rarr; All Objects** and expanding the Adapter and associated object types and object.

![CPU Idle Time](doc/test-adapter-cpu-idle-time.png)
*The CPU object's `idle-time` metric in a Management Pack named `QAAdapterName`.*

For complete documentation of the `mp-build` tool see the [MP Build Tool Documentation](doc/mp-build.md).

## Contributing

The vrealize-operations-integration-sdk project team welcomes contributions from the community. Before you start working
with vrealize-operations-integration-sdk, please read our [Developer Certificate of Origin](https://cla.vmware.com/dco).
All contributions to this repository must be signed as described on that page. Your signature certifies that you wrote
the patch or have the right to pass it on as an open-source patch. For more detailed information, refer
to [CONTRIBUTING.md](CONTRIBUTING.md).

## License

This project is licensed under the APACHE-2 License.